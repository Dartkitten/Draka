$(function(){var socketport="socket.csgo500.com";String.prototype.replaceAll=function(target,replacement){return this.split(target).join(replacement);};function escape(target){return target.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll("\"","&quot;").replaceAll("\'","&#x27;").replaceAll("\/","&#x2F;");}
var $chat=$("#chat");var $chatInput=$("#chat-input");var $chatPlayers=$("#chat-players");var $online=$("#online");var $mutePopup=$("#mute-popup");var $muteField=$("#mute-field");var $muteButton=$("#mute-button");var $muteLink=$("#mute-link");var $navBorder=$("#nav-border");var $navGame=$("#nav-game");var $navProfile=$("#nav-profile");var $navDeposit=$("#nav-deposit");var $navShop=$("#nav-shop");var $navRewards=$("#nav-rewards");var $navNotification=$("#nav-notification");var $navFaq=$("#nav-faq");var $contentGame=$("#content-game");var $contentDuel=$("#content-duel");var $contentProfile=$("#content-profile");var $contentDeposit=$("#content-deposit");var $contentShop=$("#content-shop");var $contentRewards=$("#content-rewards");var $contentFaq=$("#content-faq");var $accountLevel=$("#account-level");var $tradeUrlInput=$("#trade-url-input");var $tradeUrlSubmit=$("#trade-url-submit");var $tradeUrlLoader=$("#trade-url-loader");var $accountLevelBarInfo=$("#account-level-bar-info");var $transactionRefresh=$("#transaction-refresh");var $transactionLoader=$("#transaction-loader");var $transactionTableBody=$("#transaction-table-body");var $inventoryRefresh=$("#inventory-refresh");var $inventoryWrapper=$("#inventory-wrapper");var $inventorySearch=$("#inventory-search");var $inventorySearchLoader=$("#inventory-search-loader");var $inventoryCheckout=$("#inventory-checkout");var $inventory=$("#inventory");var $inventoryLoader=$("#inventory-loader");var $inventoryEmpty=$("#inventory-empty");var $inventoryInput=$("#inventory-input");var $inventoryCheckoutAmount=$("#inventory-checkout-amount");var $inventoryCheckoutDeposit=$("#inventory-checkout-deposit");var $inventoryCheckoutLoader=$("#inventory-checkout-loader");var $shopRefresh=$("#shop-refresh");var $shopWrapper=$("#shop-wrapper");var $shopSearch=$("#shop-search");var $shopSearchLoader=$("#shop-search-loader");var $shopNext=$(".shop-next");var $shopNextLoader=$(".shop-next-loader");var $shopPrevious=$(".shop-previous");var $shopPreviousLoader=$(".shop-previous-loader");var $shopCheckout=$("#shop-checkout");var $shop=$("#shop");var $shopLoader=$("#shop-loader");var $shopEmpty=$("#shop-empty");var $shopInput=$("#shop-input");var $shopCheckoutAmount=$("#shop-checkout-amount");var $shopCheckoutWithdraw=$("#shop-checkout-withdraw");var $shopCheckoutLoader=$("#shop-checkout-loader");var $contentRewardsVerfication=$("#content-rewards-verfication");var $contentRewardsReferrals=$("#content-rewards-referrals");var $contentRewardsDaily=$("#content-rewards-daily");var $redeemWrapper=$("#redeem-wrapper");var $verifySubmit=$("#verify-submit");var $verifyLoader=$("#verify-loader");var $referralClaimAmount=$("#referral-claim-amount");var $referralClaimLevel=$("#referral-claim-level");var $referralClaimSubmit=$("#referral-claim-submit");var $referralClaimLoader=$("#referral-claim-loader");var $referralClaimSubmitDisabled=$("#referral-claim-submit-disabled");var $rewardClaimAmount=$("#reward-claim-amount");var $rewardClaimLevel=$("#reward-claim-level");var $rewardClaimSubmit=$("#reward-claim-submit");var $rewardClaimLoader=$("#reward-claim-loader");var $rewardClaimSubmitDisabled=$("#reward-claim-submit-disabled");var $redeemInput=$("#redeem-input");var $redeemSubmit=$("#redeem-submit");var $redeemLoader=$("#redeem-loader");var $referralInput=$("#referral-input");var $referralSubmit=$("#referral-submit");var $referralLoader=$("#referral-loader");var $rewardSubmit=$("#reward-submit");var $rewardLoader=$("#reward-loader");var $wheelCanvas=$("#content-wheel-canvas");var $wheel=$("#wheel");var $wheelPointer=$("#wheel-pointer");var $wheelTimer=$("#wheel-timer");var $balance=$("#balance");var $contentWheelBalance=$("#content-wheel-balance");var $betBtnMin=$("#bet-btn-min");var $betBtn10=$("#bet-btn-10");var $betBtn100=$("#bet-btn-100");var $betBtn1k=$("#bet-btn-1k");var $betBtn10k=$("#bet-btn-10k");var $betBtnMax=$("#bet-btn-max");var $betBtnHalf=$("#bet-btn-half");var $betBtnDouble=$("#bet-btn-double");var $betInput=$("#bet-input");var $pastQueue=$("#past-queue");var $myBets2xWrapper=$("#my-bets-2x-wrapper");var $myBets3xWrapper=$("#my-bets-3x-wrapper");var $myBets5xWrapper=$("#my-bets-5x-wrapper");var $myBets50xWrapper=$("#my-bets-50x-wrapper");var $betBtn2x=$("#bet-btn-2x");var $betBtn3x=$("#bet-btn-3x");var $betBtn5x=$("#bet-btn-5x");var $betBtn50x=$("#bet-btn-50x");var $betBtn2xDisabled=$("#bet-btn-2x-disabled");var $betBtn3xDisabled=$("#bet-btn-3x-disabled");var $betBtn5xDisabled=$("#bet-btn-5x-disabled");var $betBtn50xDisabled=$("#bet-btn-50x-disabled");var $allBets2xTotalWrapper=$("#all-bets-2x-total-wrapper");var $allBets3xTotalWrapper=$("#all-bets-3x-total-wrapper");var $allBets5xTotalWrapper=$("#all-bets-5x-total-wrapper");var $allBets50xTotalWrapper=$("#all-bets-50x-total-wrapper");var $allBets2x=$("#all-bets-2x");var $allBets3x=$("#all-bets-3x");var $allBets5x=$("#all-bets-5x");var $allBets50x=$("#all-bets-50x");var $allBets2xWrapper=$("#all-bets-2x-wrapper");var $allBets3xWrapper=$("#all-bets-3x-wrapper");var $allBets5xWrapper=$("#all-bets-5x-wrapper");var $allBets50xWrapper=$("#all-bets-50x-wrapper");if(!loggedIn){$contentWheelBalance.hide();openId="";tradeUrl="";role="";value=0;playedValue=0;maxBet=0;verified=false;withdrawLock=false;muted=false;referralCode="";referrals=0;referralValue=0;redeemed=false;rewardLevel=0;rewardDate="";csrfToken="";setTimeout(function(){$("#login-background").fadeTo(1000,1);},1000);$("#gotit-btn").click(function(){$("#login-background").fadeOut(500,function(){$("#login-background").hide();});});}
var online=0;var level=Math.min(500,Math.floor(playedValue/50000));var inventoryOrder=-1;var inventorySkip=0;var inventoryFilter="";var inventory=[];var selectedInventory=[];var visibleInventory=[];var inventoryTotal=0;var inventoryPriceSort=-1;var inventorySelectedCount=0;var inventoryCheckout=0;var inventoryCheckoutCount;if(loggedIn){inventoryCheckoutCount=new CountUp("inventory-checkout-amount",0,0,0,1);}
var shopOrder=-1;var shopSkip=0;var shopFilter="";var shop=[];var selectedShop=[];var visibleShop=[];var shopTotal=0;var shopPriceSort=-1;var shopSelectedCount=0;var shopCheckout=0;var shopCheckoutCount;if(loggedIn){shopCheckoutCount=new CountUp("shop-checkout-amount",0,0,0,1);}
var chatTimeout=0;var round={};var lastRound={};var elapsedWheelTime=0;var finalWheelTime=35000;var spinning=false;var pastQueue=[];var numberBets=0;var betsCleared=true;var balanceCount=new CountUp("balance",0,value,0,1);var myBets2x=0;var myBets3x=0;var myBets5x=0;var myBets50x=0;var myBets2xCount=new CountUp("my-bets-2x",0,0,0,1);var myBets3xCount=new CountUp("my-bets-3x",0,0,0,1);var myBets5xCount=new CountUp("my-bets-5x",0,0,0,1);var myBets50xCount=new CountUp("my-bets-50x",0,0,0,1);var allBets2x=0;var allBets3x=0;var allBets5x=0;var allBets50x=0;var allBets2xTotalCount=new CountUp("all-bets-2x-total",0,0,0,1);var allBets3xTotalCount=new CountUp("all-bets-3x-total",0,0,0,1);var allBets5xTotalCount=new CountUp("all-bets-5x-total",0,0,0,1);var allBets50xTotalCount=new CountUp("all-bets-50x-total",0,0,0,1);$referralInput.val(referralCode);if(verified){$contentRewardsVerfication.hide();$contentRewardsReferrals.show();$contentRewardsDaily.show();}
if(!redeemed){$redeemWrapper.show();}
if(referralValue<=0){$referralClaimSubmit.hide();$referralClaimSubmitDisabled.css({display:"inline-block"});}
var rewardDateObj=new Date(rewardDate);if(Date.now()- rewardDateObj.getTime()<86400000){$rewardClaimSubmit.hide();$rewardClaimSubmitDisabled.css({display:"inline-block"});}else{$rewardClaimSubmit.css({display:"inline-block"});$rewardClaimSubmitDisabled.hide();}
var bar;if(loggedIn){$tradeUrlInput.val(tradeUrl);bar=new ProgressBar.Line("#account-level-bar",{easing:'easeInOut',duration:1400,color:'#C8354E',trailColor:'#26262C',svgStyle:{width:'100%',height:'100%',borderRadius:'20px',border:'2px solid #C8354E'}});}
myBets2xCount.start();myBets3xCount.start();myBets5xCount.start();myBets50xCount.start();allBets2xTotalCount.start();allBets3xTotalCount.start();allBets5xTotalCount.start();allBets50xTotalCount.start();function updateBalance(){updateBetRange(value);balanceCount.update(value);}
function updateAccountLevel(){if(loggedIn){var exp=playedValue%50000;bar.animate(exp/50000);$accountLevelBarInfo.text(formatBet(exp)+" / 50,000");$accountLevel.text("Level "+level);}}
function updateInventory(data){inventory=data;}
function updateShop(data){shop=data;}
function updateNotification(){var rewardDateObj=new Date(rewardDate);if(referralValue>0||(Date.now()- rewardDateObj.getTime()>=86400000)){$navNotification.show();}else{$navNotification.hide();}}
function updatePlayedValue(v){playedValue+=v;level=Math.min(500,Math.floor(playedValue/50000));$rewardClaimAmount.text(formatBet(50+ level*5));$rewardClaimLevel.text("Level "+ level);updateAccountLevel();}
function updateReferrals(ref){referrals+=ref;referralValue+=ref*50;$referralClaimAmount.text(referrals);$referralClaimLevel.html("<img id='referral-level-icon' src='static/images/x3.png'/>"+ formatBet(referralValue)+" to claim");if(referralValue>0){$referralClaimSubmit.show();$referralClaimSubmitDisabled.hide();}}
function updateReward(){var rewardDateObj=new Date(rewardDate);if(Date.now()- rewardDateObj.getTime()<86400000){var remainingTime=86400000-(Date.now()- rewardDateObj.getTime());var rewardHour=Math.floor((remainingTime/(1000*60*60))%24);var rewardHour1=Math.floor(rewardHour/10);var rewardHour2=rewardHour%10;var rewardMinute=Math.floor((remainingTime/(1000*60))%60);var rewardMinute1=Math.floor(rewardMinute/10);var rewardMinute2=rewardMinute%10;var rewardSecond=Math.floor((remainingTime/1000)%60);var rewardSecond1=Math.floor(rewardSecond/10);var rewardSecond2=rewardSecond%10;$rewardClaimSubmitDisabled.text(rewardHour1+""+ rewardHour2+":"+ rewardMinute1+""+ rewardMinute2+":"+ rewardSecond1+""+ rewardSecond2);}}
setTimeout(function(){$rewardClaimSubmit.css({display:"inline-block"});$rewardClaimSubmitDisabled.hide();},Math.max(0,86400000-(Date.now()- new Date(rewardDate).getTime())));setInterval(function(){updateReward();updateNotification();},1000);updateReward();updateNotification();updatePlayedValue(0);updateReferrals(0);function updateBetRange(inputValue){var minValue=Math.min(inputValue,maxBet);$betInput.attr("max",minValue);}
function formatBet(value){return value.toLocaleString();}
function unformatBet(string){return parseInt(string.replaceAll(',','').replaceAll('.',''));}
function updateWheel(angle){$wheelCanvas.css({transform:"rotate("+ angle+"deg)"});}
function updateWheelPointer(color){if(color==="#404040"){color="#505050";}
$wheelPointer.css({color:color});}
function updateWheelTimer(color){if(color==="#404040"){color="#505050";}
$wheelTimer.css({color:color});}
function filterInventory(filter){filter=filter.toLowerCase();var temp=[];for(var i=0;i<inventory.length;i++){temp.push(inventory[i]);}
if(inventoryPriceSort<0){temp.sort(function(a,b){return b.value- a.value;});}else{temp.sort(function(a,b){return a.value- b.value;});}
visibleInventory=temp;for(var j=visibleInventory.length- 1;j>=0;j--){if(visibleInventory[j].name.toLowerCase().indexOf(filter)===-1){visibleInventory.splice(j,1);continue;}
for(var k=0;k<selectedInventory.length;k++){if(visibleInventory[j].assetId===selectedInventory[k].assetId){visibleInventory.splice(j,1);break;}}}}
function disableBets(){$betBtn2x.hide();$betBtn3x.hide();$betBtn5x.hide();$betBtn50x.hide();$betBtn2xDisabled.show();$betBtn3xDisabled.show();$betBtn5xDisabled.show();$betBtn50xDisabled.show();if(myBets2x!==0){$myBets2xWrapper.css({opacity:0.3});}
if(myBets3x!==0){$myBets3xWrapper.css({opacity:0.3});}
if(myBets5x!==0){$myBets5xWrapper.css({opacity:0.3});}
if(myBets50x!==0){$myBets50xWrapper.css({opacity:0.3});}
$allBets2xWrapper.css({opacity:0.3});$allBets3xWrapper.css({opacity:0.3});$allBets5xWrapper.css({opacity:0.3});$allBets50xWrapper.css({opacity:0.3});}
function clearBets(){numberBets=0;allBets2x=0;allBets3x=0;allBets5x=0;allBets50x=0;myBets2x=0;myBets3x=0;myBets5x=0;myBets50x=0;$allBets2x.empty();$allBets3x.empty();$allBets5x.empty();$allBets50x.empty();allBets2xTotalCount.reset();allBets3xTotalCount.reset();allBets5xTotalCount.reset();allBets50xTotalCount.reset();$allBets2xTotalWrapper.css({opacity:0});$allBets3xTotalWrapper.css({opacity:0});$allBets5xTotalWrapper.css({opacity:0});$allBets50xTotalWrapper.css({opacity:0});myBets2xCount.reset();myBets3xCount.reset();myBets5xCount.reset();myBets50xCount.reset();$myBets2xWrapper.css({opacity:0});$myBets3xWrapper.css({opacity:0});$myBets5xWrapper.css({opacity:0});$myBets50xWrapper.css({opacity:0});}
clearBets();var messageCount=0;function generateChatMessage(data){var message="";message+="<div class='message'>";message+="	<div class='message-avatar-wrapper'>";message+="		<img class='message-avatar' src='"+ data.avatar+"' href='https://steamcommunity.com/profiles/"+ data.openId+"' target='_blank'/>";message+="	</div>";message+="	<div class='message-content-wrapper'>";if(role==="admin"||role==="mod"){if(data.role==="admin"||data.role==="mod"){message+="	<a class='message-author-"+ data.role+" mute-popup' id='"+ data.openId+"'>"+ escape(data.username)+" </a>";}else{message+="	<a class='message-author-"+ data.role+" mute-popup' id='"+ data.openId+"'>[Lvl "+ data.level+"] "+ escape(data.username)+" </a>";}}else{if(data.role==="admin"||data.role==="mod"){message+="	<a class='message-author-"+ data.role+"'>"+ escape(data.username)+" </a>";}else{message+="	<a class='message-author-"+ data.role+"' href='https://steamcommunity.com/profiles/"+ data.openId+"' target='_blank' >[Lvl "+ data.level+"] "+ escape(data.username)+" </a>";}}
message+="		<br/><span class='message-content'>"+ escape(data.msg)+"</span>";message+="	</div>";message+="</div>";$chat.append(message);messageCount++;if(messageCount>60){$chat.children().first().remove();messageCount--;}}
function generateErrorChatMessage(data){var message="";message+="<div class='message'>";message+="	<div class='message-avatar-wrapper'>";message+="		<img class='message-avatar' src='https://steamcdn-a.akamaihd.net/steamcommunity/public/images/avatars/fe/fef49e7fa7e1997310d705b2a6158ff8dc1cdfeb_medium.jpg' />";message+="	</div>";message+="	<div class='message-content-wrapper'>";message+="	<a class='message-author-"+"admin"+"'>"+"System"+" </a>";message+="		<br/><span class='message-content'>"+ escape(data)+"</span>";message+="	</div>";message+="</div>";$chat.append(message);messageCount++;if(messageCount>60){$chat.children().first().remove();messageCount--;}
var objDiv=document.getElementById("chat");$chat.animate({scrollTop:objDiv.scrollHeight},0);}
function generateRound(data){lastRound=round;round=data.round;winner=data.winner;numberBets=0;$wheelTimer.show();if(winner){var elapsedTime=35000- round.time;elapsedWheelTime=elapsedTime+ 2000;if(elapsedTime<10000){spinning=true;betsCleared=false;$wheelTimer.css({opacity:0});rotate((winner.random+ winner.spread)*360/54,elapsedTime);if(winner.reservations){for(var i=0;i<winner.reservations.length;i++){var winnerList=winner.reservations[i];for(var j=0;j<winnerList.length;j++){generateReservation(winnerList[j]);}}
if(winner.reservations[winner.choice]){for(var n=0;n<winner.reservations[winner.choice].length;n++){var reservation=winner.reservations[winner.choice][n];if(reservation.openId===openId){if(winner.choice===0){value-=2*reservation.worth;}else if(winner.choice===1){value-=3*reservation.worth;}else if(winner.choice===2){value-=5*reservation.worth;}else{value-=50*reservation.worth;}}}}
pastQueue.shift();generatePastQueue();}
disableBets();setTimeout(function(){if(winner.reservations){if(winner.reservations[winner.choice]){if(winner.choice===0){$betBtn2x.show();$betBtn2xDisabled.hide();if(myBets2x!==0){$myBets2xWrapper.css({opacity:1});}
myBets2x*=2;myBets2xCount.update(myBets2x);$allBets2xWrapper.css({opacity:1});allBets2x*=2;allBets2xTotalCount.update(allBets2x);for(var n=0;n<winner.reservations[winner.choice].length;n++){var reservation2x=winner.reservations[winner.choice][n];if(reservation2x.openId===openId){value+=2*reservation2x.worth;}}}else if(winner.choice===1){$betBtn3x.show();$betBtn3xDisabled.hide();if(myBets3x!==0){$myBets3xWrapper.css({opacity:1});}
myBets3x*=3;myBets3xCount.update(myBets3x);$allBets3xWrapper.css({opacity:1});allBets3x*=3;allBets3xTotalCount.update(allBets3x);for(var v=0;v<winner.reservations[winner.choice].length;v++){var reservation3x=winner.reservations[winner.choice][v];if(reservation3x.openId===openId){value+=3*reservation3x.worth;}}}else if(winner.choice===2){$betBtn5x.show();$betBtn5xDisabled.hide();if(myBets5x!==0){$myBets5xWrapper.css({opacity:1});}
myBets5x*=5;myBets5xCount.update(myBets5x);$allBets5xWrapper.css({opacity:1});allBets5x*=5;allBets5xTotalCount.update(allBets5x);for(var b=0;b<winner.reservations[winner.choice].length;b++){var reservation5x=winner.reservations[winner.choice][b];if(reservation5x.openId===openId){value+=5*reservation5x.worth;}}}else{$betBtn50x.show();$betBtn50xDisabled.hide();if(myBets50x!==0){$myBets50xWrapper.css({opacity:1});}
myBets50x*=50;myBets50xCount.update(myBets50x);$allBets50xWrapper.css({opacity:1});allBets50x*=50;allBets50xTotalCount.update(allBets50x);for(var h=0;h<winner.reservations[winner.choice].length;h++){var reservation50x=winner.reservations[winner.choice][h];if(reservation50x.openId===openId){value+=50*reservation50x.worth;}}}}}else{if(lastRound.reservations){if(lastRound.reservations[winner.choice]){if(winner.choice===0){$betBtn2x.show();$betBtn2xDisabled.hide();if(myBets2x!==0){$myBets2xWrapper.css({opacity:1});}
myBets2x*=2;myBets2xCount.update(myBets2x);$allBets2xWrapper.css({opacity:1});allBets2x*=2;allBets2xTotalCount.update(allBets2x);for(var m=0;m<lastRound.reservations[winner.choice].length;m++){var last2xReservation=lastRound.reservations[winner.choice][m];if(last2xReservation.openId===openId){value+=2*last2xReservation.worth;}}}else if(winner.choice===1){$betBtn3x.show();$betBtn3xDisabled.hide();if(myBets3x!==0){$myBets3xWrapper.css({opacity:1});}
myBets3x*=3;myBets3xCount.update(myBets3x);$allBets3xWrapper.css({opacity:1});allBets3x*=3;allBets3xTotalCount.update(allBets3x);for(var c=0;c<lastRound.reservations[winner.choice].length;c++){var last3xReservation=lastRound.reservations[winner.choice][c];if(last3xReservation.openId===openId){value+=3*last3xReservation.worth;}}}else if(winner.choice===2){$betBtn5x.show();$betBtn5xDisabled.hide();if(myBets5x!==0){$myBets5xWrapper.css({opacity:1});}
myBets5x*=5;myBets5xCount.update(myBets5x);$allBets5xWrapper.css({opacity:1});allBets5x*=5;allBets5xTotalCount.update(allBets5x);for(var x=0;x<lastRound.reservations[winner.choice].length;x++){var last5xReservation=lastRound.reservations[winner.choice][x];if(last5xReservation.openId===openId){value+=5*last5xReservation.worth;}}}else{$betBtn50x.show();$betBtn50xDisabled.hide();if(myBets50x!==0){$myBets50xWrapper.css({opacity:1});}
myBets50x*=50;myBets50xCount.update(myBets50x);$allBets50xWrapper.css({opacity:1});allBets50x*=50;allBets50xTotalCount.update(allBets50x);for(var z=0;z<lastRound.reservations[winner.choice].length;z++){var last50xReservation=lastRound.reservations[winner.choice][z];if(last50xReservation.openId===openId){value+=50*last50xReservation.worth;}}}}}}
updateBalance();spinning=false;var color=chartData.datasets[0].backgroundColor[winner.random];updateWheel(wheel.angle);updateWheelPointer(color);pastQueue.unshift({id:winner.id,hash:winner.hash,salt:winner.salt,random:winner.random,choice:winner.choice,spread:winner.spread});if(pastQueue.length>25){pastQueue.pop();}
generatePastQueue();setTimeout(function(){clearBets();$betBtn2x.show();$betBtn3x.show();$betBtn5x.show();$betBtn50x.show();$betBtn2xDisabled.hide();$betBtn3xDisabled.hide();$betBtn5xDisabled.hide();$betBtn50xDisabled.hide();$myBets2xWrapper.css({opacity:0});$myBets3xWrapper.css({opacity:0});$myBets5xWrapper.css({opacity:0});$myBets50xWrapper.css({opacity:0});$allBets2xWrapper.css({opacity:1});$allBets3xWrapper.css({opacity:1});$allBets5xWrapper.css({opacity:1});$allBets50xWrapper.css({opacity:1});$wheelTimer.css({opacity:1});for(var k=0;k<round.reservations.length;k++){var roundList=round.reservations[k];for(var l=0;l<roundList.length;l++){generateReservation(roundList[l]);}}
betsCleared=true;setTimeout(function(){disableBets();},20000);},3000);},10000- elapsedTime);}else{spinning=false;generatePastQueue();$betBtn2x.show();$betBtn3x.show();$betBtn5x.show();$betBtn50x.show();$betBtn2xDisabled.hide();$betBtn3xDisabled.hide();$betBtn5xDisabled.hide();$betBtn50xDisabled.hide();wheel.angle=360-(winner.random+ winner.spread)*360/54;wheel.offsetAngle=wheel.angle;var color=chartData.datasets[0].backgroundColor[winner.random];updateWheel(wheel.angle);updateWheelPointer(color);updateWheelTimer(color);for(var k=0;k<round.reservations.length;k++){var roundList=round.reservations[k];for(var l=0;l<roundList.length;l++){generateReservation(roundList[l]);}}
setTimeout(function(){disableBets();},round.time- 2000);}
updateBalance();$wheelPointer.css({opacity:1});$wheel.css({opacity:1});}}
function generatePastQueue(){$pastQueue.empty();for(var i=pastQueue.length- 1;i>=0;i--){var choice=pastQueue[i].choice;var pastContent="";if(choice===0){pastContent+="<div class='col-s12 past-0'><div></div></div>";}else if(choice===1){pastContent+="<div class='offset-col-s3 col-s9 past-1'><div></div></div>";}else if(choice===2){pastContent+="<div class='offset-col-s6 col-s6 past-2'><div></div></div>";}else{pastContent+="<div class='offset-col-s9 col-s3 past-3'><div></div></div>";}
$pastQueue.append(pastContent);}}
function generateReservation(data){var betContent="";betContent+='<div class="all-bets-content">';betContent+='	<div class="all-bets-content-user">';betContent+='		<img class="all-bets-content-avatar" src="'+ data.avatar+'">'+"[Lvl "+ data.level+"] "+ escape(data.username);betContent+='	</div>';betContent+='	<div class="all-bets-content-bet">';if(data.choice===0){betContent+='	<img src="static/images/x2.png" class="bet-icon"/>';}else if(data.choice===1){betContent+='	<img src="static/images/x3.png" class="bet-icon"/>';}else if(data.choice===2){betContent+='	<img src="static/images/x5.png" class="bet-icon"/>';}else{betContent+='	<img src="static/images/x50.png" class="bet-icon"/>';}
betContent+='<span class="bet-amount">'+ formatBet(data.worth)+'</span>';betContent+='	</div>';betContent+='</div>';if(data.choice===0){allBets2x+=data.worth;var added2x=false;$allBets2x.children().each(function(){var current=unformatBet($(this).find(".bet-amount").text());if(data.worth>current){added2x=true;if(data.worth>=200){$(betContent).insertBefore($(this));}
return false;}});if(!added2x){if(data.worth>=200){$allBets2x.append(betContent);}}
allBets2xTotalCount.update(allBets2x);$allBets2xTotalWrapper.css({opacity:1});if(data.openId===openId){myBets2x+=data.worth;$myBets2xWrapper.css({opacity:1});myBets2xCount.update(myBets2x);numberBets++;}}else if(data.choice===1){allBets3x+=data.worth;var added3x=false;$allBets3x.children().each(function(){var current=unformatBet($(this).find(".bet-amount").text());if(data.worth>current){added3x=true;if(data.worth>=200){$(betContent).insertBefore($(this));}
return false;}});if(!added3x){if(data.worth>=200){$allBets3x.append(betContent);}}
allBets3xTotalCount.update(allBets3x);$allBets3xTotalWrapper.css({opacity:1});if(data.openId===openId){myBets3x+=data.worth;$myBets3xWrapper.css({opacity:1});myBets3xCount.update(myBets3x);numberBets++;}}else if(data.choice===2){allBets5x+=data.worth;var added5x=false;$allBets5x.children().each(function(){var current=unformatBet($(this).find(".bet-amount").text());if(data.worth>current){added5x=true;if(data.worth>=200){$(betContent).insertBefore($(this));}
return false;}});if(!added5x){if(data.worth>=200){$allBets5x.append(betContent);}}
allBets5xTotalCount.update(allBets5x);$allBets5xTotalWrapper.css({opacity:1});if(data.openId===openId){myBets5x+=data.worth;$myBets5xWrapper.css({opacity:1});myBets5xCount.update(myBets5x);numberBets++;}}else{allBets50x+=data.worth;var added50x=false;$allBets50x.children().each(function(){var current=unformatBet($(this).find(".bet-amount").text());if(data.worth>current){added50x=true;if(data.worth>=200){$(betContent).insertBefore($(this));}
return false;}});if(!added50x){if(data.worth>=200){$allBets50x.append(betContent);}}
allBets50xTotalCount.update(allBets50x);$allBets50xTotalWrapper.css({opacity:1});if(data.openId===openId){myBets50x+=data.worth;$myBets50xWrapper.css({opacity:1});myBets50xCount.update(myBets50x);numberBets++;}}}
function generateReservationSuccess(data){value-=data.worth;updatePlayedValue(data.worth);updateBalance();if(data.choice===0){$betBtn2x.show();$betBtn2xDisabled.hide();}else if(data.choice===1){$betBtn3x.show();$betBtn3xDisabled.hide();}else if(data.choice===2){$betBtn5x.show();$betBtn5xDisabled.hide();}else{$betBtn50x.show();$betBtn50xDisabled.hide();}}
function generateReservationFail(){Materialize.toast('Your bet was unsuccessful.',3000,'toast-notification');$betBtn2x.show();$betBtn3x.show();$betBtn5x.show();$betBtn50x.show();$betBtn2xDisabled.hide();$betBtn3xDisabled.hide();$betBtn5xDisabled.hide();$betBtn50xDisabled.hide();}
function generateWithdraw(data){selectedShop=[];shopSelectedCount=0;shopCheckout=0;shopCheckoutCount.update(shopCheckout);Materialize.toast('Withdraw Successful. (Trade Offer ID: '+ data.tradeOfferId+")",30000,'toast-notification');}
function generateWithdrawFail(data){Materialize.toast('Withdraw Cancelled. (Trade Offer ID: '+ data.tradeOfferId+")",30000,'toast-notification');}
function generateDeposit(data){selectedInventory=[];inventorySelectedCount=0;inventoryCheckout=0;inventoryCheckoutCount.update(inventoryCheckout);Materialize.toast('Deposit Successful. Added '+ formatBet(data.worth)+' Bux. (Trade Offer ID: '+ data.tradeOfferId+")",30000,'toast-notification');}
function generateDepositFail(data){Materialize.toast('Deposit Cancelled. (Trade Offer ID: '+ data.tradeOfferId+")",30000,'toast-notification');}
function generateTransactions(data){$transactionTableBody.empty();for(var i=0;i<data.length;i++){var transaction=data[i];var transactionHtml="<tr>";transactionHtml+="<td>"+ moment(transaction.date).format('MMMM Do YYYY, hh:mm:ss a')+"</td>";transactionHtml+="<td>"+ transaction.tradeOfferId+"</td>";transactionHtml+="<td>"+ transaction.action+"</td>";transactionHtml+="<td>"+ transaction.value+"</td>";transactionHtml+="<td>";for(var j=0;j<transaction.skins.length;j++){var skin=transaction.skins[j];transactionHtml+=skin.name+"</br>";}
transactionHtml+="</td>";transactionHtml+="<td>"+ transaction.confirmationCode+"</td>";transactionHtml+="<td>"+ transaction.state+"</td>";transactionHtml+="</tr>";$transactionTableBody.append(transactionHtml);}}
function generateInventory(){$inventoryCheckout.empty();$inventory.empty();for(var i=0;i<selectedInventory.length;i++){var selectedSkin=selectedInventory[i];var selectedItem="";selectedItem+="<div id='inventory-"+ selectedSkin.assetId+"' class='inventory-item-selected noselect'>";selectedItem+="<span class='item-name'>"+ selectedSkin.name+"</span>";selectedItem+="<img class='item-image' src='https://steamcommunity-a.akamaihd.net/economy/image/"+ selectedSkin.url+"'/>";selectedItem+="<div class='item-price'><img class='item-icon' src='static/images/x3.png'/>"+ formatBet(selectedSkin.value)+"</div>";selectedItem+="</div>";$inventoryCheckout.append(selectedItem);}
for(var j=0;j<visibleInventory.length;j++){var skin=visibleInventory[j];var inventoryItem="";if(skin.value<500||skin.name.indexOf("Souvenir")!==-1||skin.name.indexOf("Sticker")!==-1){inventoryItem+="<div id='inventory-"+ skin.assetId+"' class='inventory-item-faded noselect'>";}else{inventoryItem+="<div id='inventory-"+ skin.assetId+"' class='inventory-item noselect'>";}
inventoryItem+="<span class='item-name'>"+ skin.name+"</span>";inventoryItem+="<img class='item-image' src='https://steamcommunity-a.akamaihd.net/economy/image/"+ skin.url+"'/>";inventoryItem+="<div class='item-price'><img class='item-icon' src='static/images/x3.png'/>"+ formatBet(skin.value)+"</div>";inventoryItem+="</div>";$inventory.append(inventoryItem);}}
function generateShop(){$shopCheckout.empty();$shop.empty();visibleShop=[];for(var n=0;n<shop.length;n++){visibleShop.push(shop[n]);}
for(var l=visibleShop.length- 1;l>=0;l--){for(var k=0;k<selectedShop.length;k++){if(visibleShop[l].assetId===selectedShop[k].assetId){visibleShop.splice(l,1);break;}}}
for(var i=0;i<selectedShop.length;i++){var selectedSkin=selectedShop[i];var selectedItem="";selectedItem+="<div id='shop-"+ selectedSkin.assetId+"-"+ selectedSkin.openId+"' class='shop-item-selected noselect'>";selectedItem+="<span class='item-name'>"+ selectedSkin.name+"</span>";selectedItem+="<img class='item-image' src='https://steamcommunity-a.akamaihd.net/economy/image/"+ selectedSkin.url+"'/>";selectedItem+="<div class='item-price'><img class='item-icon' src='static/images/x3.png'/>"+ formatBet(selectedSkin.value)+"</div>";selectedItem+="</div>";$shopCheckout.append(selectedItem);}
for(var j=0;j<visibleShop.length;j++){var skin=visibleShop[j];var shopItem="";shopItem+="<div id='shop-"+ skin.assetId+"-"+ skin.openId+"' class='shop-item noselect'>";shopItem+="<span class='item-name'>"+ skin.name+"</span>";shopItem+="<img class='item-image' src='https://steamcommunity-a.akamaihd.net/economy/image/"+ skin.url+"'/>";shopItem+="<div class='item-price'><img class='item-icon' src='static/images/x3.png'/>"+ formatBet(skin.value)+"</div>";shopItem+="</div>";$shop.append(shopItem);}}
$(document).delegate('.nav-element','click',function(){var tab=$(this).attr('id');$(".nav-element-active").attr('class','nav-element noselect');$(this).attr('class','nav-element-active noselect');if(tab==="nav-game"){$navBorder.animate({top:0,},200);$contentGame.show();$contentDuel.hide();$contentProfile.hide();$contentDeposit.hide();$contentShop.hide();$contentRewards.hide();$contentFaq.hide();}else if(tab==="nav-duels"){$navBorder.animate({top:77,},200);$contentGame.hide();$contentDuel.show();$contentProfile.hide();$contentDeposit.hide();$contentShop.hide();$contentRewards.hide();$contentFaq.hide();}else if(tab==="nav-profile"){$navBorder.animate({top:154,},200);$contentGame.hide();$contentDuel.hide();$contentProfile.show();$contentDeposit.hide();$contentShop.hide();$contentRewards.hide();$contentFaq.hide();}else if(tab==="nav-deposit"){$navBorder.animate({top:231,},200);$contentGame.hide();$contentDuel.hide();$contentProfile.hide();$contentDeposit.show();$contentShop.hide();$contentRewards.hide();$contentFaq.hide();}else if(tab==="nav-shop"){$navBorder.animate({top:308,},200);$contentGame.hide();$contentDuel.hide();$contentProfile.hide();$contentDeposit.hide();$contentShop.show();$contentRewards.hide();$contentFaq.hide();}else if(tab==="nav-rewards"){$navBorder.animate({top:385,},200);$contentGame.hide();$contentDuel.hide();$contentProfile.hide();$contentDeposit.hide();$contentShop.hide();$contentRewards.show();$contentFaq.hide();}else{if(loggedIn){$navBorder.animate({top:462,},200);}else{$navBorder.animate({top:154,},200);}
$contentGame.hide();$contentDuel.hide();$contentProfile.hide();$contentDeposit.hide();$contentShop.hide();$contentRewards.hide();$contentFaq.show();}});$(window).keypress(function(e){if(e.keyCode===13){if(muted){generateErrorChatMessage("You are muted.");$chatInput.val("");return;}
if(level<10){generateErrorChatMessage("You need Level 10 to be able to chat.");$chatInput.val("");return;}
var text=$chatInput.val();if(text.trim()){if(chatTimeout<=0){socket.emit("message",text);chatTimeout+=1000;}else{generateErrorChatMessage("Wait a few seconds before chatting again.");}}
$chatInput.val("");}});setInterval(function(){chatTimeout-=100;if(chatTimeout<=0){chatTimeout=0;}},100);$inventoryInput.on("input change",function(){filterInventory($inventoryInput.val());generateInventory();});$tradeUrlSubmit.click(function(){var text=$tradeUrlInput.val();if(text.trim()){$.ajax({url:"/trade-url",method:'POST',data:{tradeUrl:text,_csrf:csrfToken}}).done(function(data){tradeUrl=text;$tradeUrlLoader.fadeOut(1000,function(){$tradeUrlSubmit.show();});Materialize.toast("Trade URL updated.",3000,'toast-notification');}).error(function(error){if(error.status!==500){Materialize.toast("Trade URL: "+ error.responseText+".",3000,'toast-notification');}else{Materialize.toast("Trade URL: Server Error.",3000,'toast-notification');}
$tradeUrlLoader.fadeOut(1000,function(){$tradeUrlSubmit.show();});});$tradeUrlLoader.css({display:"inline-block"});$tradeUrlSubmit.hide();}});$transactionRefresh.click(function(){$.ajax({url:"/transactions",method:'POST',data:{_csrf:csrfToken}}).done(function(data){generateTransactions(data);$transactionLoader.fadeOut(1000,function(){$transactionRefresh.css({display:"inline-block"});});Materialize.toast("Transactions Refreshed.",3000,'toast-notification');}).error(function(error){if(error.status!==500){Materialize.toast("Transactions: "+ error.responseText+".",3000,'toast-notification');}else{Materialize.toast("Transactions: Server Error.",3000,'toast-notification');}
$transactionLoader.fadeOut(1000,function(){$transactionRefresh.css({display:"inline-block"});});});$transactionRefresh.hide();$transactionLoader.css({display:"inline-block"});});$inventoryRefresh.click(function(){$inventoryInput.val("");$.ajax({url:"/inventory",method:'POST',data:{order:inventoryOrder,skip:inventorySkip,filter:"",_csrf:csrfToken}}).done(function(data){updateInventory(data);selectedInventory=[];inventorySelectedCount=0;inventoryCheckout=0;inventoryCheckoutCount.update(inventoryCheckout);filterInventory($inventoryInput.val());generateInventory();if(inventory.length===0){$inventoryEmpty.text("Your inventory is empty.");$inventoryEmpty.show();}else{$inventoryEmpty.hide();}
$inventoryLoader.fadeOut(500,function(){$inventoryRefresh.show();});Materialize.toast("Inventory Refreshed.",3000,'toast-notification');}).error(function(error){if(error.status!==500){Materialize.toast("Inventory Refresh: "+ error.responseText+".",3000,'toast-notification');}else{Materialize.toast("Inventory Refresh: Server Error.",3000,'toast-notification');}
$inventoryLoader.fadeOut(500,function(){$inventoryRefresh.show();});});$inventoryLoader.css({display:"inline-block"});$inventoryRefresh.hide();});$inventoryCheckoutDeposit.click(function(){if(!tradeUrl){Materialize.toast("Please set your Trade URL in the Account tab.",3000,'toast-notification');return;}
var skinsToSend=[];for(var i=0;i<selectedInventory.length;i++){skinsToSend.push(selectedInventory[i].assetId);}
if(skinsToSend.length<=0){Materialize.toast("Please select skins to deposit.",3000,'toast-notification');return;}
$.ajax({url:"/deposit",method:'POST',data:{skins:JSON.stringify(skinsToSend),_csrf:csrfToken}}).done(function(data){$inventoryCheckoutLoader.fadeOut(500,function(){$inventoryCheckoutDeposit.show();});Materialize.toast("Trade Offer Sent. You have 5 minutes to accept. Confirmation code: "+ data.confirmationCode,30000,'toast-notification');}).error(function(error){if(error.status!==500){Materialize.toast("Deposit Failed: "+ error.responseText+".",30000,'toast-notification');}else{Materialize.toast("Deposit Failed: Server Error.",30000,'toast-notification');}
$inventoryCheckoutLoader.fadeOut(500,function(){$inventoryCheckoutDeposit.show();});});$inventoryCheckoutLoader.css({display:"inline-block"});$inventoryCheckoutDeposit.hide();});$shopSearch.click(function(){shopSkip=0;shopFilter=$shopInput.val();if(!shopFilter){return;}
$.ajax({url:"/shop",method:'POST',data:{order:shopOrder,skip:shopSkip,filter:shopFilter,_csrf:csrfToken}}).done(function(data){updateShop(data);generateShop();if(shop.length===0){$shopEmpty.text("The shop is empty.");$shopEmpty.show();}else{$shopEmpty.hide();}
if(data.length>=100){$shopNext.css({display:"inline-block"});}else{$shopNext.hide();}
if(shopSkip>0){$shopPrevious.css({display:"inline-block"});}else{$shopPrevious.hide();}
$shopSearchLoader.fadeOut(500,function(){$shopSearch.show();});}).error(function(error){if(error.status!==500){Materialize.toast("Shop Refresh: "+ error.responseText+".",3000,'toast-notification');}else{Materialize.toast("Shop Refresh: Server Error",3000,'toast-notification');}
$shopSearchLoader.fadeOut(500,function(){$shopSearch.show();});});$shopSearchLoader.css({display:"inline-block"});$shopSearch.hide();});$shopRefresh.click(function(){$shopInput.val("");shopSkip=0;$.ajax({url:"/shop",method:'POST',data:{order:shopOrder,skip:shopSkip,filter:"",_csrf:csrfToken}}).done(function(data){shopOrder=-1;shopSkip=0;selectedShop=[];shopSelectedCount=0;shopCheckout=0;shopCheckoutCount.update(shopCheckout);updateShop(data);generateShop();if(shop.length===0){$shopEmpty.text("The shop is empty.");$shopEmpty.show();}else{$shopEmpty.hide();}
if(data.length>=100){$shopNext.css({display:"inline-block"});}else{$shopNext.hide();}
if(shopSkip>0){$shopPrevious.css({display:"inline-block"});}else{$shopPrevious.hide();}
$shopLoader.fadeOut(500,function(){$shopRefresh.show();});Materialize.toast("Shop Refreshed",3000,'toast-notification');}).error(function(error){if(error.status!==500){Materialize.toast("Shop Refresh: "+ error.responseText+".",3000,'toast-notification');}else{Materialize.toast("Shop Refresh: Server Error",3000,'toast-notification');}
$shopLoader.fadeOut(500,function(){$shopRefresh.show();});});$shopLoader.css({display:"inline-block"});$shopRefresh.hide();});$shopNext.click(function(){shopFilter=$shopInput.val();$.ajax({url:"/shop",method:'POST',data:{order:shopOrder,skip:shopSkip+100,filter:shopFilter,_csrf:csrfToken}}).done(function(data){shopOrder=-1;shopSkip+=100;updateShop(data);generateShop();if(shop.length===0){$shopEmpty.text("The shop is empty.");$shopEmpty.show();}else{$shopEmpty.hide();}
$shopNextLoader.fadeOut(500,function(){if(data.length>=100){$shopNext.css({display:"inline-block"});}else{$shopNext.hide();}
if(shopSkip>0){$shopPrevious.css({display:"inline-block"});}else{$shopPrevious.hide();}});}).error(function(error){if(error.status!==500){Materialize.toast("Shop Next: "+ error.responseText+".",3000,'toast-notification');}else{Materialize.toast("Shop Next: Server Error",3000,'toast-notification');}
$shopNextLoader.fadeOut(500,function(){$shopNext.show();});});$shopNextLoader.css({display:"inline-block"});$shopNext.hide();});$shopPrevious.click(function(){shopFilter=$shopInput.val();$.ajax({url:"/shop",method:'POST',data:{order:shopOrder,skip:Math.max(0,shopSkip-100),filter:shopFilter,_csrf:csrfToken}}).done(function(data){shopOrder=-1;shopSkip-=100;updateShop(data);generateShop();if(shop.length===0){$shopEmpty.text("The shop is empty.");$shopEmpty.show();}else{$shopEmpty.hide();}
$shopPreviousLoader.fadeOut(500,function(){if(data.length>=100){$shopNext.css({display:"inline-block"});}else{$shopNext.hide();}
if(shopSkip>0){$shopPrevious.css({display:"inline-block"});}else{$shopPrevious.hide();}});}).error(function(error){if(error.status!==500){Materialize.toast("Shop Previous: "+ error.responseText+".",3000,'toast-notification');}else{Materialize.toast("Shop Previous: Server Error",3000,'toast-notification');}
$shopPreviousLoader.fadeOut(500,function(){$shopPrevious.show();});});$shopPreviousLoader.css({display:"inline-block"});$shopPrevious.hide();});$shopCheckoutWithdraw.click(function(){if(!tradeUrl){Materialize.toast("Please set your Trade URL in the Account tab.",3000,'toast-notification');return;}
var skinsToSend=[];var totalValue=0;for(var i=0;i<selectedShop.length;i++){totalValue+=selectedShop[i].value;skinsToSend.push({assetId:selectedShop[i].assetId,openId:selectedShop[i].openId});}
if(skinsToSend.length<=0){Materialize.toast("Please select skins to withdraw.",3000,'toast-notification');return;}
if(balance>1){Materialize.toast("Insufficient funds.",3000,'toast-notification');return;}
$.ajax({url:"/withdraw",method:'POST',data:{skins:JSON.stringify(skinsToSend),_csrf:csrfToken}}).done(function(data){$shopCheckoutLoader.fadeOut(500,function(){$shopCheckoutWithdraw.show();});for(var i=0;i<data.length;i++){if(data[i].success){var withdrawValue=0;for(var j=0;j<data[i].skins.length;j++){withdrawValue+=data[i].skins[j].value;});Materialize.toast("Trade Offer Sent ("+(i+1)+"/"+ data.length+"). You have 5 minutes to accept. Confirmation code: "+ data[i].confirmationCode,30000,'toast-notification');}else{Materialize.toast("Trade Offer Error ("+(i+1)+"/"+ data.length+").",30000,'toast-notification');}}}).error(function(error){if(error.status!==500){Materialize.toast("Withdraw Failed: "+ error.responseText+".",30000,'toast-notification');}else{Materialize.toast("Withdraw Failed: Server Error.",30000,'toast-notification');}
$shopCheckoutLoader.fadeOut(500,function(){$shopCheckoutWithdraw.show();});});$shopCheckoutLoader.css({display:"inline-block"});$shopCheckoutWithdraw.hide();});$verifySubmit.click(function();$contentRewardsDaily.fadeIn(500);});Materialize.toast("Verification Successful.",3000,'toast-notification');}).error(function(error){if(error.status!==500){Materialize.toast("Verification Failed: "+ error.responseText+".",3000,'toast-notification');}else{Materialize.toast("Verification Failed: Server Error.",3000,'toast-notification');}
$verifyLoader.fadeOut(500,function(){$verifySubmit.show();});});$verifyLoader.css({display:"inline-block"});$verifySubmit.hide();});$redeemSubmit.click(function(){var text=$redeemInput.val();if(text.trim()){$.ajax({url:"/redeem",method:'POST',data:{referralCode:text,_csrf:csrfToken}}).done(function(data){redeemed=true;value+=1000;updateBalance();$redeemWrapper.fadeOut(500);Materialize.toast("Added 1,000 Bux.",5000,'toast-notification');}).error(function(error){if(error.status!==500){Materialize.toast("Redeem: "+ error.responseText,5000,'toast-notification');}else{Materialize.toast("Redeem: Server Error",5000,'toast-notification');}
$redeemLoader.fadeOut(1000,function(){$redeemSubmit.show();});});$redeemLoader.css({display:"inline-block"});$redeemSubmit.hide();}});$referralSubmit.click(function(){var text=$referralInput.val();if(text.trim()){$.ajax({url:"/referral-code",method:'POST',data:{referralCode:text,_csrf:csrfToken}}).done(function(data){referralCode=text;$referralLoader.fadeOut(1000,function(){$referralSubmit.show();});Materialize.toast("Referral code updated.",3000,'toast-notification');}).error(function(error){if(error.status!==500){Materialize.toast("Referral Code: "+ error.responseText+".",3000,'toast-notification');}else{Materialize.toast("Referral Code: Server Error.",3000,'toast-notification');}
$referralLoader.fadeOut(1000,function(){$referralSubmit.show();});});$referralLoader.css({display:"inline-block"});$referralSubmit.hide();}});$referralClaimSubmit.click(function(){$.ajax({url:"/collect",method:'POST',data:{_csrf:csrfToken}}).done(function(data){var oldReferralValue=referralValue;referralValue=0;value+=oldReferralValue;updateBalance();updateReferrals(0);updateNotification();$referralClaimLoader.fadeOut(1000,function(){$referralClaimSubmitDisabled.css({display:"inline-block"});});Materialize.toast("Collected "+ oldReferralValue+" Bux.",5000,'toast-notification');}).error(function(error){if(error.status!==500){Materialize.toast("Referral Claim: "+ error.responseText+".",5000,'toast-notification');}else{Materialize.toast("Referral Claim: Server Error.",5000,'toast-notification');}
$referralClaimLoader.fadeOut(1000,function(){$referralClaimSubmit.css({display:"inline-block"});});});$referralClaimLoader.css({display:"inline-block"});$referralClaimSubmit.hide();});$rewardClaimSubmit.click(function(){$.ajax({url:"/reward",method:'POST',data:{_csrf:csrfToken}}).done(function(data){var rewardValue=50+ Math.min(500,Math.floor(playedValue/50000))*5;rewardDate=(new Date()).toISOString();value+=rewardValue;updateBalance();$rewardClaimLoader.fadeOut(1000,function(){setTimeout(function(){$rewardClaimSubmit.css({display:"inline-block"});$rewardClaimSubmitDisabled.hide();},86400000);updateNotification();$rewardClaimSubmit.hide();$rewardClaimSubmitDisabled.css({display:"inline-block"});});Materialize.toast("Collected "+ rewardValue+" Bux.",5000,'toast-notification');}).error(function(error){if(error.status!==500){Materialize.toast("Reward Claim: "+ error.responseText+".",5000,'toast-notification');}else{Materialize.toast("Reward Claim: Server Error.",5000,'toast-notification');}
$rewardClaimLoader.fadeOut(1000,function(){$rewardClaimSubmit.css({display:"inline-block"});});});$rewardClaimLoader.css({display:"inline-block"});$rewardClaimSubmit.hide();});function updateBetInput(inputValue){var maxValue=Math.min(maxBet,value);inputValue=Math.min(maxValue,inputValue);$betInput.val(inputValue);}
$betBtnMin.click(function(){updateBetInput(0);});$betBtn10.click(function(){var inputValue=isNaN(parseInt($betInput.val()))?0:parseInt($betInput.val());updateBetInput(inputValue+ 10);});$betBtn100.click(function(){var inputValue=isNaN(parseInt($betInput.val()))?0:parseInt($betInput.val());updateBetInput(inputValue+ 100);});$betBtn1k.click(function(){var inputValue=isNaN(parseInt($betInput.val()))?0:parseInt($betInput.val());updateBetInput(inputValue+ 1000);});$betBtn10k.click(function(){var inputValue=isNaN(parseInt($betInput.val()))?0:parseInt($betInput.val());updateBetInput(inputValue+ 10000);});$betBtnHalf.click(function(){var inputValue=isNaN(parseInt($betInput.val()))?0:parseInt($betInput.val());updateBetInput(Math.floor(inputValue/2));});$betBtnDouble.click(function(){var inputValue=isNaN(parseInt($betInput.val()))?0:parseInt($betInput.val());updateBetInput(inputValue*2);});$betBtnMax.click(function(){updateBetInput(value);});$betInput.on("input change",function(){var maxValue=Math.min(maxBet,value);if(parseInt($betInput.val())>maxValue){$betInput.val(maxValue);}});function makeReservation(choice,worth){var inputValue=parseInt($betInput.val());if(!loggedIn){Materialize.toast("Please login to bet.",3000,'toast-notification');return;}
if(numberBets>=4){Materialize.toast("You can't have more than 4 bets at a time",3000,'toast-notification');return;}
if(isNaN(inputValue)||inputValue<10){Materialize.toast('You need to bet at least 10 Bux',3000,'toast-notification');return;}
if(inputValue>value){Materialize.toast("You don't have enough to bet",3000,'toast-notification');return;}
socket.emit("reserve",{choice:choice,worth:inputValue,roundId:round.id});if(choice===0){$betBtn2x.hide();$betBtn2xDisabled.show();}else if(choice===1){$betBtn3x.hide();$betBtn3xDisabled.show();}else if(choice===2){$betBtn5x.hide();$betBtn5xDisabled.show();}else{$betBtn50x.hide();$betBtn50xDisabled.show();}}
$betBtn2x.click(function(){var inputValue=parseInt($betInput.val());makeReservation(0,inputValue);});$betBtn3x.click(function(){var inputValue=parseInt($betInput.val());makeReservation(1,inputValue);});$betBtn5x.click(function(){var inputValue=parseInt($betInput.val());makeReservation(2,inputValue);});$betBtn50x.click(function(){var inputValue=parseInt($betInput.val());makeReservation(3,inputValue);});$(document).delegate('.inventory-item','click',function(){if(role!=="admin"&&role!=="mod"){if(inventorySelectedCount>=10){Materialize.toast("You can only deposit 10 skins at a time",3000,'toast-notification');return;}}
var id=$(this).attr('id');var assetId=id.substring(10,id.length);var skin;for(var i=0;i<inventory.length;i++){if(inventory[i].assetId===assetId){skin=inventory[i];break;}}
if(skin){selectedInventory.push(skin);$(this).attr('class','inventory-item-selected');inventoryCheckout+=skin.value;inventoryCheckoutCount.update(inventoryCheckout);inventorySelectedCount++;}
filterInventory($inventoryInput.val());generateInventory();});$(document).delegate('.inventory-item-selected','click',function(){var id=$(this).attr('id');var assetId=id.substring(10,id.length);var price=0;for(var j=selectedInventory.length- 1;j>=0;j--){if(selectedInventory[j].assetId===assetId){price=selectedInventory[j].value;selectedInventory.splice(j,1);break;}}
inventorySelectedCount--;inventoryCheckout-=price;inventoryCheckoutCount.update(inventoryCheckout);filterInventory($inventoryInput.val());generateInventory();});$(document).delegate('.shop-item','click',function(){if(role!=="admin"&&role!=="mod"){if(shopSelectedCount>=10){Materialize.toast("You can only withdraw 10 skins at a time",3000,'toast-notification');return;}}
var idTag=$(this).attr('id');var id=idTag.substring(5,idTag.length);var parts=id.split('-');var assetId=parts[0];var openId=parts[1];var skin;for(var i=0;i<shop.length;i++){if(shop[i].assetId===assetId&&shop[i].openId===openId){skin=shop[i];break;}}
if(skin){selectedShop.push(skin);$(this).attr('class','shop-item-selected');shopCheckout+=skin.value;shopCheckoutCount.update(shopCheckout);shopSelectedCount++;}
generateShop();});$(document).delegate('.shop-item-selected','click',function(){var idTag=$(this).attr('id');var id=idTag.substring(5,idTag.length);var parts=id.split('-');var assetId=parts[0];var openId=parts[1];var price=0;for(var j=selectedShop.length- 1;j>=0;j--){if(selectedShop[j].assetId===assetId&&selectedShop[j].openId===openId){price=selectedShop[j].value;selectedShop.splice(j,1);break;}}
shopSelectedCount--;shopCheckout-=price;shopCheckoutCount.update(shopCheckout);generateShop();});$(document).delegate('.mute-popup','click',function(){var url=$(this).attr('id');var hisOpenId=url;$("#mute-profile").attr('href',"https://steamcommunity.com/profiles/"+ url);console.log(hisOpenId);$("#mute-modal").openModal();$("#mute-input").val(hisOpenId);});$("#mute-button").click(function(){var muteopenId=$("#mute-input").val();$.ajax({url:'/mute',method:'POST',data:{openId:muteopenId,_csrf:csrfToken}}).done(function(data){Materialize.toast("Muted "+ muteopenId,1000,'toast-notification');}).error(function(err){Materialize.toast("Error Muting "+ muteopenId,1000,'toast-notification');});});var socket=io(socketport,{transports:['websocket']});socket.on('chat queue',function(data){$chat.empty();for(var i=0;i<data.length;i++){generateChatMessage(data[i]);}
generateErrorChatMessage("Spamming, advertising, or sharing your referral code will result in a PERMANENT mute.");var objDiv=document.getElementById("chat");$chat.animate({scrollTop:objDiv.scrollHeight},500);});socket.on('chat',function(data){generateChatMessage(data);var objDiv=document.getElementById("chat");$chat.animate({scrollTop:objDiv.scrollHeight},500);});socket.on('past queue',function(data){pastQueue=data;});socket.on('round',function(data){generateRound(data);});socket.on('reservation',function(data){round.reservations[data.choice].push(data);if(betsCleared){generateReservation(data);}});socket.on('reservation success',function(data){generateReservationSuccess(data);});socket.on('reservation fail',function(){generateReservationFail();});socket.on('deposit',function(data){generateDeposit(data);value+=data.worth;updateBalance();});socket.on('deposit fail',function(data){generateDepositFail(data);});socket.on('withdraw',function(data){generateWithdraw(data);});socket.on('withdraw fail',function(data){generateWithdrawFail(data);value+=data.worth;updateBalance();});socket.on('referral',function(data){updateReferrals(1);updateNotification();});socket.on('number players',function(data){$chatPlayers.show();$online.text(formatBet(data));});var duels={};var duelEndTime=10000;var division=1/54;var color50x="#FFC870";var color5x="#45B5DA";var color3x="#C8354E";var color2x="#404040";var colorBorder="#26262C";var label50x="50x";var label5x="5x";var label3x="3x";var label2x="2x";var chartData={labels:[],datasets:[{data:[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],backgroundColor:[color50x,color5x,color2x,color3x,color2x,color3x,color2x,color3x,color2x,color5x,color2x,color5x,color2x,color3x,color2x,color3x,color2x,color3x,color2x,color5x,color2x,color5x,color2x,color3x,color2x,color3x,color2x,color3x,color2x,color3x,color2x,color3x,color2x,color5x,color2x,color5x,color2x,color3x,color2x,color3x,color2x,color3x,color2x,color5x,color2x,color5x,color2x,color3x,color2x,color3x,color2x,color3x,color2x,color5x,],borderColor:[colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder,colorBorder],borderWidth:[5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5]}]};var options={cutoutPercentage:94,};Chart.defaults.global.tooltips.enabled=false;var c=$wheel;var ct=c.get(0).getContext('2d');var myDoughnutChart=new Chart(ct,{type:'doughnut',data:chartData,options:options});window.requestAnimFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(callback){window.setTimeout(callback,1000/60);};})();var wheel={time:-1,endTime:10000,angle:0,offsetAngle:0,endAngle:0,speed:0,acceleration:0};function rotate(targetAngle,time){var realTargetAngle=360- targetAngle;var angleThreshold=720;wheel.endAngle=angleThreshold+(360+ realTargetAngle- wheel.angle)%360;wheel.speed=2*wheel.endAngle/wheel.endTime;wheel.acceleration=-1*wheel.speed/wheel.endTime;wheel.time=time;}
var before=Date.now();function rotateLoop(){var after=Date.now();var delta=after- before;before=after;if(wheel.time>=0){wheel.time+=delta;if(wheel.time>wheel.endTime){wheel.angle=wheel.offsetAngle+ wheel.speed*wheel.endTime+ 0.5*wheel.acceleration*wheel.endTime*wheel.endTime;wheel.angle=wheel.angle%360;wheel.offsetAngle=wheel.angle;wheel.time=-1;}else{wheel.angle=wheel.offsetAngle+ wheel.speed*wheel.time+ 0.5*wheel.acceleration*wheel.time*wheel.time;}}
elapsedWheelTime+=delta;for(var i=0;i<Object.keys(duels).length;i++){var duel=duels[Object.keys(duels)[i]];if(duel.time>=0){duel.time+=delta;if(duel.time>=duelEndTime){duel.angle=duel.speed*duelEndTime+ 0.5*duel.acceleration*duelEndTime*duelEndTime;duel.time=-1;}else{duel.angle=duel.speed*duel.time+ 0.5*duel.acceleration*duel.time*duel.time;}}}}
function renderLoop(){var renderAngle=wheel.angle;var division=Math.floor(((360+(360-renderAngle%360))%360)/360*54);
var pointerColor=chartData.datasets[0].backgroundColor[division];if(spinning){updateWheel(renderAngle);updateWheelPointer(pointerColor);}else{updateWheelTimer(pointerColor);var timeLeft=(finalWheelTime- elapsedWheelTime)/1000;
timeLeft=Math.max(0,timeLeft);if(timeLeft>=0){if(timeLeft<9.995){$wheelTimer.text("0"+timeLeft.toFixed(2));}else{$wheelTimer.text(timeLeft.toFixed(2));}}}
for(var i=0;i<Object.keys(duels).length;i++){var duel=duels[Object.keys(duels)[i]];var duelOffsetAngle=duel.angle+ 180;var duelDivision=Math.floor(Math.floor(((360+(360-duel.angle%360))%360)/360*2));
var duelPointerColor=duel.duelChart.data.datasets[0].backgroundColor[1+duelDivision];duel.duelPointer.css({color:duelPointerColor});duel.duelWheel.css({transform:"rotate("+ duelOffsetAngle+"deg)"});}
requestAnimFrame(renderLoop);}
setInterval(rotateLoop,5);renderLoop();function generateCreateDuel(data){var duelId=data.duelId;var username=data.username;var worth=data.worth;var choice=data.choice;var choiceData=[];if(choice===0){choiceData=[0,1,0,1];}else{choiceData=[1,0,1,0];}
var duelData={labels:[],datasets:[{data:choiceData,backgroundColor:["#333","#C8354E","#45B5DA","#333"],borderColor:["#26262C","#26262C","#26262C","#26262C"]}]};var duelContent="";duelContent+='<div id="duel-'+ duelId+'" class="duel-item">';if(choice===0){duelContent+='	<div id="duel-'+ duelId+'-header" class="duel-item-header">';duelContent+='		<span>'+ escape(username)+'</span><br/>';duelContent+='		<img src="static/images/x3.png" class="bet-icon"/><span id="duel-'+ duelId+'-worth-0"></span>';duelContent+='	</div>';}else{duelContent+='	<div id="duel-'+ duelId+'-footer" class="duel-item-footer">';duelContent+='		<img src="static/images/x5.png" class="bet-icon"/><span id="duel-'+ duelId+'-worth-1"></span><br/>';duelContent+='		<span>'+ escape(username)+'</span>';duelContent+='	</div>';}
duelContent+='	<div id="duel-'+ duelId+'-wheel-wrapper" class="duel-item-wheel-wrapper noselect">';duelContent+='		<canvas id="duel-'+ duelId+'-wheel" class="duel-item-wheel"></canvas>';duelContent+='	</div>';duelContent+='	<div id="duel-'+ duelId+'-pointer" class="duel-wheel-pointer noselect" style="display:none;">';duelContent+='		<i class="material-icons">navigation</i>';duelContent+='	</div>';duelContent+='</div>';$("#duel-coming-soon-sample").append(duelContent);var duelCount=new CountUp("duel-"+ duelId+"-worth-"+ choice,0,0,0,1);duelCount.start();duelCount.update(worth);var $duel=$("#duel-"+ duelId);var $duelPointer=$("#duel-"+ duelId+"-pointer");var $duelWheel=$("#duel-"+ duelId+"-wheel-wrapper");var ctx=$("#duel-"+ duelId+"-wheel").get(0).getContext("2d");var duelChart=new Chart(ctx,{type:'doughnut',data:duelData,options:{cutoutPercentage:90}});duels[duelId]={username:username,worth:worth,choice:choice,duel:$duel,duelData:duelData,duelChart:duelChart,duelPointer:$duelPointer,duelWheel:$duelWheel,duelCount:duelCount,time:-1,angle:0,speed:0,acceleration:0};}
function generateJoinDuel(data){var duel=duels[data.duelId];var username=data.username;var otherChoice=duel.choice;var otherWorth=duel.worth;var choice=data.choice;var spread=data.spread;var myChoice=otherChoice===0?1:0;var duelContent="";if(otherChoice===1){duelContent+='	<div id="duel-'+ data.duelId+'-header" class="duel-item-header">';duelContent+='		<span>'+ escape(username)+'</span><br/>';duelContent+='		<img src="static/images/x3.png" class="bet-icon"/><span id="duel-'+ data.duelId+'-worth-0"></span>';duelContent+='	</div>';}else{duelContent+='	<div id="duel-'+ data.duelId+'-footer" class="duel-item-footer">';duelContent+='		<img src="static/images/x5.png" class="bet-icon"/><span id="duel-'+ data.duelId+'-worth-1"></span><br/>';duelContent+='		<span>'+ escape(username)+'</span>';duelContent+='	</div>';}
duel.duel.append(duelContent);var duelCount=new CountUp("duel-"+ data.duelId+"-worth-"+ myChoice,0,0,0,1);duelCount.start();duelCount.update(duel.worth);duel.duelChart.data.datasets[0].data=[0,1,1,0];duel.duelChart.update();setTimeout(function(){duel.duelPointer.show();var $duelHeader=$("#duel-"+ data.duelId+"-header");var $duelFooter=$("#duel-"+ data.duelId+"-footer");duel.duelHeader=$duelHeader;duel.duelFooter=$duelFooter;$duelHeader.css({opacity:0.3});$duelFooter.css({opacity:0.3});var duelTargetAngle=(choice+ spread)*360/2;var targetAngle=1800+ 360- duelTargetAngle;duel.speed=2*targetAngle/duelEndTime;duel.acceleration=-1*duel.speed/duelEndTime;duel.time=0;setTimeout(function(){if(choice===0){$duelHeader.css({opacity:1});}else{$duelFooter.css({opacity:1});}
if(choice===myChoice){duelCount.update(duel.worth*2);}else{duel.duelCount.update(duel.worth*2);}
setTimeout(function(){},2000);},10000);},1000);}
var usernames=["Quiet","Ale","Max","Art","Ricanare","PRD","_Ash","Ethan","Soxy","Bradberry","KevinSmallChode","Raph","Venix","Swarm","Moro","Luca","Sodaa","CarmaS"];for(var index=0;index<15;index++){generateCreateDuel({duelId:index,username:usernames[Math.floor(Math.random()*usernames.length)],worth:Math.floor(Math.random()*10000)*10,choice:Math.floor(Math.random()*2)});if(Math.random()>=0.6){generateJoinDuel({duelId:index,username:usernames[Math.floor(Math.random()*usernames.length)],choice:Math.floor(Math.random()*2),spread:0.05+ Math.floor(Math.random()*0.9*1000)/1000
});}}
$(document).on('click','#toast-container .toast',function(){$(this).fadeOut(function(){$(this).remove();});});});
